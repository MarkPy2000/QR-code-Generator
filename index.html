<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced QR Code Generator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.css">
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f0f0f0;
        padding: 20px;
    }
    .container {
        background-color: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        max-width: 800px;
        margin: 0 auto;
    }
    h2 {
        color: #007bff;
        margin-bottom: 30px;
    }
    .nav-tabs {
        margin-bottom: 20px;
    }
    .form-group {
        margin-bottom: 20px;
    }
    #qrCode {
        width: 250px;
        height: 250px;
        margin: 20px auto;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #fff;
    }
    #qrCode img {
        max-width: 100%;
        max-height: 100%;
    }
    .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
    }
    .btn-primary:hover {
        background-color: #0056b3;
        border-color: #0056b3;
    }
    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }
    .btn-secondary:hover {
        background-color: #5a6268;
        border-color: #545b62;
    }
    .alert {
        margin-top: 20px;
    }
    .sp-replacer {
        width: 100%;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        padding: 0.375rem 0.75rem;
    }
    .sp-preview {
        width: calc(100% - 20px);
    }
    .sp-dd {
        display: none;
    }
</style>
</head>
<body>
    <div class="container">
        <h2 class="text-center mb-4">Advanced QR Code Generator & Scanner</h2>
        
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="basic-tab" data-toggle="tab" href="#basic" role="tab">Basic</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="custom-tab" data-toggle="tab" href="#custom" role="tab">Customize</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="scan-tab" data-toggle="tab" href="#scan" role="tab">Scan QR Code</a>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="basic" role="tabpanel">
                <div class="form-group mt-3">
                    <label for="contentType">Content Type:</label>
                    <select class="form-control" id="contentType">
                        <option value="url">URL</option>
                        <option value="text">Text</option>
                        <option value="email">Email</option>
                        <option value="wifi">Wi-Fi</option>
                        <option value="vcard">vCard</option>
                    </select>
                </div>
                <div id="dynamicInputs"></div>
                <div class="form-group">
                    <label for="errorCorrectionLevel">Error Correction Level:</label>
                    <select class="form-control" id="errorCorrectionLevel">
                        <option value="L">Low (7%)</option>
                        <option value="M">Medium (15%)</option>
                        <option value="Q">Quartile (25%)</option>
                        <option value="H">High (30%)</option>
                    </select>
                </div>
            </div>
            
            <div class="tab-pane fade" id="custom" role="tabpanel">
                <div class="form-group mt-3">
                    <label for="foregroundColor">Foreground Color:</label>
                    <input type="text" id="foregroundColor" class="form-control">
                </div>
                <div class="form-group">
                    <label for="backgroundColor">Background Color:</label>
                    <input type="text" id="backgroundColor" class="form-control">
                </div>
                <div class="form-group">
                    <label for="logo">Upload Logo:</label>
                    <input type="file" class="form-control-file" id="logo">
                </div>
                <div class="form-group">
                    <label for="frame">Select Frame:</label>
                    <select class="form-control" id="frame">
                        <option value="none">None</option>
                        <option value="square">Square</option>
                    </select>
                </div>
            </div>
            <div class="tab-pane fade" id="scan" role="tabpanel">
                <div class="mt-3">
                    <div id="reader"></div>
                    <div id="scanResult" class="mt-3"></div>
                </div>
            </div>
        </div>
        
        
        <button id="generateBtn" class="btn btn-primary btn-block mt-3">Generate QR Code</button>
        <div id="qrCode" class="mt-3"></div>
        <button id="downloadBtn" class="btn btn-secondary btn-block mt-2" style="display: none;">Download QR Code</button>
        <div id="alert" class="alert mt-3" role="alert"></div>
    <div id="googleTranslate"></div>
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<script>
    function googleTranslateElementInit() {
        new google.translate.TranslateElement({
            pageLanguage: 'en',
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE
        }, 'googleTranslate');
    }
</script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.js"></script>
     <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <script>
    $(document).ready(function() {
        const contentType = $('#contentType');
        const dynamicInputs = $('#dynamicInputs');
        const errorCorrectionLevel = $('#errorCorrectionLevel');
        const generateBtn = $('#generateBtn');
        const qrCode = $('#qrCode');
        const downloadBtn = $('#downloadBtn');
        const alertDiv = $('#alert');
        const languageSelect = document.getElementById('#languageSelect');
        const translateBtn = document.getElementById('#translateBtn');
        const isDynamic = $('#isDynamic');
        const foregroundColor = $('#foregroundColor');
        const backgroundColor = $('#backgroundColor');
        const logo = $('#logo');
        const frame = $('#frame');

        // Initialize color pickers
        foregroundColor.spectrum({ preferredFormat: "hex", showInput: true });
        backgroundColor.spectrum({ preferredFormat: "hex", showInput: true });

        contentType.on('change', updateDynamicInputs);
        generateBtn.on('click', generateQRCode);
        downloadBtn.on('click', downloadQRCode);

        function updateDynamicInputs() {
            dynamicInputs.empty();
            switch (contentType.val()) {
                case 'url':
                    dynamicInputs.append('<input type="url" class="form-control" id="urlInput" placeholder="Enter URL">');
                    break;
                case 'text':
                    dynamicInputs.append('<textarea class="form-control" id="textInput" placeholder="Enter text"></textarea>');
                    break;
                case 'email':
                    dynamicInputs.append('<input type="email" class="form-control" id="emailInput" placeholder="Enter email address">');
                    dynamicInputs.append('<input type="text" class="form-control mt-2" id="subjectInput" placeholder="Enter subject">');
                    dynamicInputs.append('<textarea class="form-control mt-2" id="bodyInput" placeholder="Enter email body"></textarea>');
                    break;
                case 'wifi':
                    dynamicInputs.append('<input type="text" class="form-control" id="ssidInput" placeholder="Enter SSID">');
                    dynamicInputs.append('<select class="form-control mt-2" id="encryptionType"><option value="WPA">WPA/WPA2</option><option value="WEP">WEP</option><option value="nopass">No encryption</option></select>');
                    break;
                case 'vcard':
                    dynamicInputs.append('<input type="text" class="form-control" id="nameInput" placeholder="Enter name">');
                    dynamicInputs.append('<input type="tel" class="form-control mt-2" id="phoneInput" placeholder="Enter phone number">');
                    dynamicInputs.append('<input type="email" class="form-control mt-2" id="emailVcardInput" placeholder="Enter email">');
                    dynamicInputs.append('<input type="text" class="form-control mt-2" id="addressInput" placeholder="Enter address">');
                    break;
            }
        }

        function generateQRCode() {
            const content = getContentBasedOnType();
            if (!content) {
                showAlert('danger', 'Please fill in all required fields.');
                return;
            }

            try {
                qrCode.empty();
                const qr = qrcode(0, errorCorrectionLevel.val());
                qr.addData(content);
                qr.make();

                const qrImage = qr.createDataURL(10, 0);
                const img = $('<img>').attr('src', qrImage);
                qrCode.append(img);

                if (frame.val() !== 'none') {
                    applyFrame(img, frame.val());
                }

                if (logo.prop('files')[0]) {
                    applyLogo(img);
                }

                downloadBtn.show();
                showAlert('success', 'QR Code generated successfully!');


            } catch (error) {
                console.error('Error generating QR Code:', error);
                showAlert('danger', 'Error generating QR Code. Please try again.');
            }
        }

        function getContentBasedOnType() {
        switch (contentType.val()) {
            case 'url':
                return $('#urlInput').val();
            case 'text':
                return $('#textInput').val();
            case 'email':
                return `mailto:${$('#emailInput').val()}?subject=${encodeURIComponent($('#subjectInput').val())}&body=${encodeURIComponent($('#bodyInput').val())}`;
            case 'wifi':
                return `WIFI:T:${$('#encryptionType').val()};S:${$('#ssidInput').val()};P:${$('#wifiPasswordInput').val()};;`;
            case 'vcard':
                return `BEGIN:VCARD\nVERSION:3.0\nN:${$('#nameInput').val()}\nTEL:${$('#phoneInput').val()}\nEMAIL:${$('#emailVcardInput').val()}\nADR:${$('#addressInput').val()}\nEND:VCARD`;
            default:
                return '';
        }
    }

    function downloadQRCode() {
        const qrCodeImage = qrCode.find('img');
        if (qrCodeImage.length) {
            const link = document.createElement('a');
            link.download = 'qrcode.png';
            link.href = qrCodeImage.attr('src');
            link.click();
        } else {
            showAlert('danger', 'No QR Code found to download.');
        }
    }

    function applyFrame(img, frameType) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const size = img[0].width;
        canvas.width = size;
        canvas.height = size;

        ctx.drawImage(img[0], 0, 0, size, size);

        ctx.strokeStyle = foregroundColor.spectrum('get').toHexString();
        ctx.lineWidth = size / 20;

        if (frameType === 'square') {
            ctx.strokeRect(0, 0, size, size);
        }

        img.attr('src', canvas.toDataURL());
    }

    function applyLogo(img) {
    const reader = new FileReader();
    reader.onload = function(e) {
        const logo = new Image();
        logo.onload = function() {
            const qrSize = img[0].width;
            const logoSize = qrSize / 4;  // Logo size is 1/4 of the QR code size
            
            // Create a new canvas with extra height for the logo
            const canvas = document.createElement('canvas');
            canvas.width = qrSize;
            canvas.height = qrSize + logoSize + 20; // Extra 20px for padding
            const ctx = canvas.getContext('2d');

            // Fill the canvas with a white background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw the logo at the top
            const logoX = (qrSize - logoSize) / 2;
            const logoY = 10; // 10px padding from the top
            ctx.drawImage(logo, logoX, logoY, logoSize, logoSize);

            // Draw the QR code below the logo
            ctx.drawImage(img[0], 0, logoSize + 20, qrSize, qrSize);

            // Create a new image element
            const newImg = $('<img>');
            newImg.attr('src', canvas.toDataURL());
            
            // Set the size of the new image to fit within its container
            newImg.css({
                'max-width': '100%',
                'height': 'auto'
            });

            // Replace the old image with the new one
            img.replaceWith(newImg);

            // Update the global img reference
            img = newImg;
        };
        logo.src = e.target.result;
    };
    reader.readAsDataURL(logo.prop('files')[0]);
}


    function showAlert(type, message) {
        alertDiv.removeClass().addClass(`alert alert-${type}`).text(message);
        setTimeout(() => {
            alertDiv.removeClass().addClass('alert').empty();
        }, 5000);
    }

    const scanTab = $('#scan-tab');
    const scanResult = $('#scanResult');
    let html5QrcodeScanner = null;

    scanTab.on('shown.bs.tab', initializeScanner);
    scanTab.on('hidden.bs.tab', stopScanner);

    function initializeScanner() {
        if (!html5QrcodeScanner) {
            html5QrcodeScanner = new Html5QrcodeScanner(
                "reader", 
                { fps: 10, qrbox: 250 },
                /* verbose= */ false
            );
            html5QrcodeScanner.render(onScanSuccess, onScanFailure);
        }
    }

    function stopScanner() {
        if (html5QrcodeScanner) {
            html5QrcodeScanner.clear();
            html5QrcodeScanner = null;
        }
    }

    function onScanSuccess(decodedText, decodedResult) {
        console.log(`Code matched = ${decodedText}`, decodedResult);
        scanResult.html(`
            <div class="alert alert-success">
                <h4>QR Code Scanned Successfully</h4>
                <p>Content: ${decodedText}</p>
            </div>
        `);
        
        // Optional: Stop scanning after successful scan
        // html5QrcodeScanner.clear();
    }

    function onScanFailure(error) {
        // Handle scan failure, usually better to ignore and keep scanning.
        // console.warn(`Code scan error = ${error}`);
    }

    function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'en', includedLanguages: 'en,fr,es,de,ja,ko,zh-CN,zh-TW,ru,pt,it,ar,hi'}, 'googleTranslate');
        }

        translateBtn.addEventListener('click', () => {
            const targetLanguage = languageSelect.value;
            if (targetLanguage === 'en') {
                showAlert('warning', 'Page is already in English.');
                return;
            }
            google.translate.TranslateElement.getInstance().changeLanguage(targetLanguage);
        });

    // Initialize the dynamic inputs
    updateDynamicInputs();
});
</script>
</body>
</html>
